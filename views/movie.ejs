<%- include('./components/header')%>

    <body style="background-color: #cae8fb;">
        <%- include('./components/navigation')%>
            <link rel="stylesheet" href="/movie.css">


            <div class="container-fluid" style="margin-top: 50px;">
                <div class="row">
                    <div class="col-lg-3" style="margin-left: 30px;">
                        <img class="poster" src="<%= movie.movieImage %>" alt="movie poster">
                        <div class="movie-details">
                            <p><strong>Genre:</strong>
                                <%= movie.genre %>
                            </p>
                            <p><strong>Length:</strong>
                                <%= movie.movieLength %> minutes
                            </p>
                            <p><strong>Author:</strong>
                                <%= movie.movieAuthor %>
                            </p>
                            <p><strong>Price:</strong> <%= movie.moviePrice %>$(per ticket)</p>
                            <p>
                                <% if (movie.ageRestriction===0) { %>
                                    No age restriction
                                    <% } else { %>
                                        <strong>Age Restriction: </strong>
                                        <%= movie.ageRestriction %>+
                                            <% } %>
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="movie-details" style="margin: 10%;">
                            <h1>
                                <%= movie.movieName %>
                            </h1>
                            <div class="movie-description">
                                <h5>Movie Description</h2>
                                    <%=movie.movieDescription%>
                            </div>
                        </div>
                        <% let selectedChairAmount=0; %>
                        <% let chairArray=movie.chairArray %>
                                    <div class="tickets-purchase">
                                        <div class="seats-container">
                                            <div class="screen" style="height: 100px">
                                                <img src="/pics/screenCinema.png" alt="screen" style="width: 600px;">
                                            </div>
                                            <div style="display: flex; flex-wrap: wrap;">
                                                <div style="margin-top: 0px; margin-left: 20px; width: 20px;">
                                                    <% for(let i = 0; i< movie.chairAmount/12; i++) {%>
                                                        <h6 style="color: white; padding: 6.5px;"><%=i+1%></h6>
                                                    <% } %>
                                                </div>
                                                <% let tickets = 0%>
                                                <div class="seats"
                                                    style="display: flex; flex-wrap: wrap;justify-content: center; align-items: center; width: 80%; margin-left: 20px;">
                                                    <% let line = 0 %>
                                                    <% for(let i=0; i < movie.chairAmount ; i++) {
                                                        if(movie.chairArray[i]==false){%>
                                                        <button onclick="SelectSeat(this.id, '<%=movie.moviePrice%>')" id="<%=i%>"
                                                            style="background: none; border: none; padding: 0;"><img
                                                                id="image<%=i%>" src="/pics/SeatAvailable.png"
                                                                alt="greenChair(Available)"
                                                                style="height: 40px; width: 40px;"></button>
                                                                <%selectedChairAmount++;%>
                                                        <% }else{ %>
                                                            <img id="<%=i%>" src="/pics/SeatUnavailable.png"
                                                                alt="grayChair(not Available)"
                                                                style="height: 40px; width: 40px;">
                                                            <% }} %>
                                                </div>
                                            </div>
                                        </div>
                                        <h4 style="margin-left: 220px;">Total price: <span id = "totalPrice"></span>$</h6>
                                            <div class="purchase-btn">
                                                <span style="font-size: larger; margin-left:25%;">Purchase</span><br>
                                                <span style="font-size: 0.7em; margin-left:25%;">
                                                    <%=selectedChairAmount%> Chairs selected
                                                </span>
                                            </div>
                                    </div>
                    </div>

                </div>
            </div>



            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
                crossorigin="anonymous">
                </script>
            <script>
                tickets = 0;
                let totalPrice = 0
                document.getElementById("totalPrice").innerHTML = totalPrice;

                function SelectSeat(id,price) {
                    let tp = document.getElementById("totalPrice");
                    let seat = document.getElementById("image" + id);
                    if (seat.getAttribute('src') === '/pics/SeatAvailable.png')
                    {
                        seat.src = '/pics/SeatSelected.png';
                        tickets++;
                    }
                    else
                    {
                        seat.src = '/pics/SeatAvailable.png';
                        tickets--;
                    }
                    totalPrice = tickets * price;
                    tp.innerHTML = totalPrice;
                }
            </script>
    </body>

    </html>